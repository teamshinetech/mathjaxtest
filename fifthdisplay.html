<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="telephone=no" name="format-detection"/>
    <title>Display 5</title>
    <style>
        body {
            background-color: #eeeeee;
        }

        * {
            box-sizing: border-box;
        }

        button {
            width: 4rem;
            height: 6rem;
            background-color: yellow;
        }

        .drop-active {
            border: dashed red 3px;
        }

        .drop-target {
            background-color: aqua;
        }
    </style>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
    });


    </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full">
    </script>
    <script src="./vue.js"></script>
    <script src="./interact.js"></script>
    <!--<script src="https://unpkg.com/vue/dist/vue.js"></script>-->
    <!--<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>-->
</head>
<body>
<article class="container" id="app">
    <section class="title">
        <p>{{description}}</p>
    </section>
    <section class="content">
        <section class="answer">
            <div class="item">
                <button class="draggable">{{answers[currentDisplayIndex].displayValue}}</button>
            </div>
        </section>
        <section class="questions">
            <div class="item dropzone" v-for="question in questions">
                <button>{{question.displayValue}}</button>
            </div>
        </section>
    </section>
</article>
<script>
    // target elements with the "draggable" class
    interact('.draggable')
        .draggable({
            // enable inertial throwing
            inertia: true,
            // enable autoScroll
            autoScroll: true,
            // keep the element within the area of it's parent
            restrict: {
                restriction: ".content",
                endOnly: true,
                elementRect: {top: 0, left: 0, bottom: 1, right: 1}
            },
            // call this function on every dragmove event
            onmove: function (event) {
                var target = event.target,
                    // keep the dragged position in the data-x/data-y attributes
                    x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
                    y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

                // translate the element
                target.style.webkitTransform =
                    target.style.transform =
                        'translate(' + x + 'px, ' + y + 'px)';

                // update the posiion attributes
                target.setAttribute('data-x', x);
                target.setAttribute('data-y', y);
            },
            // call this function on every dragend event
            onend: function (event) {
                console.log('moved a distance of '
                    + (Math.sqrt(event.dx * event.dx +
                        event.dy * event.dy) | 0) + 'px');
            }
        });

    // enable draggables to be dropped into this
    interact('.dropzone').dropzone({
        // only accept elements matching this CSS selector
        accept: '.draggable',
        // Require a 75% element overlap for a drop to be possible
        overlap: 0.75,

        // listen for drop related events:

        ondropactivate: function (event) {
            // add active dropzone feedback
//            event.target.innerHTML = "drop in";
            event.target.classList.add('drop-active');
        },
        ondragenter: function (event) {
            var draggableElement = event.relatedTarget,
                dropzoneElement = event.target;

            // feedback the possibility of a drop
//            dropzoneElement.classList.add('drop-target');
//            draggableElement.classList.add('can-drop');
            draggableElement.innerHTML = 'Dragged in';
            dropzoneElement.classList.add('drop-target');
        },
        ondragleave: function (event) {
            // remove the drop feedback style
            event.target.classList.remove('drop-target');
//            event.relatedTarget.classList.remove('can-drop');
            event.relatedTarget.innerHTML = 'Dragged out';
        },
        ondrop: function (event) {
            event.relatedTarget.innerHTML = 'Dropped';
        },
        ondropdeactivate: function (event) {
            // remove active dropzone feedback
            event.target.classList.remove('drop-active');
            event.target.classList.remove('drop-target');
        }
    });

    var dataSource = {
        CorrectAnswer: ">1/2|<1/2|1/2",
        DescriptionText: "Drop each fraction in the right circle!",
        Display1: "$${7 \over 12}$$|$${6 \over 14}$$|$${8 \over 16}$$",
        Display2: "$$< {1 \over 2}$$|$$> {1 \over 2}$$|$${1 \over 2}$$",
        Display2RawValue: "<1/2|>1/2|1/2"
    };

    function updateData(data) {
        var updatedData = initializeData(data);
        app.$data.answers = updatedData.answers;
        app.$data.questions = updatedData.questions;
    }

    function sendMessageToNative(message) {
        try {
            window.webkit.messageHandlers.submit.postMessage(message);
        } catch (ex) {
            throw Error(ex);
        }
    }

    function initializeData(data) {
        var transferredDisplay1 = data.Display1.replace(/\\*over/g, '\\over');
        var transferredDisplay2 = data.Display2.replace(/\\*over/g, '\\over');
        var display1StringArray = transferredDisplay1.split('|');
        var display2StringArray = transferredDisplay2.split('|');
        var correctAnswers = data.CorrectAnswer.split('|');
        var display2RawValueArray = data.Display2RawValue.split('|');
        var answers = [];
        var questions = [];
        for (var i = 0; i < correctAnswers.length; i++) {
            var answerItem = {displayValue: display1StringArray[i], correctValue: correctAnswers[i]};
            var questionItem = {displayValue: display2StringArray[i], rawValue: display2RawValueArray[i]};
            answers.push(answerItem);
            questions.push(questionItem);
        }
        return ({
            description: data.DescriptionText,
            answers: answers,
            questions: questions
        })
    }
    var modifiedData = initializeData(dataSource);
    console.log("data " + JSON.stringify(modifiedData));
    var app = new Vue({
        el: '#app',
        data: {
            currentDisplayIndex: 0,
            hasFilledOut: false,
            answers: modifiedData.answers,
            questions: modifiedData.questions,
            description: modifiedData.description
        },
        methods: {
            moveIntoNextQuestion: function () {
                this.currentDisplayIndex++;
            }
        }
    })
</script>
</body>
</html>